[gd_scene load_steps=5 format=2]

[ext_resource path="res://Scenes/UI/Chat.tscn" type="PackedScene" id=1]
[ext_resource path="res://Scenes/UI/TouchControls.tscn" type="PackedScene" id=2]
[ext_resource path="res://Scenes/Locations/World.tscn" type="PackedScene" id=3]

[sub_resource type="GDScript" id=1]

script/source = "extends Node

func _ready():
	Global.id = get_tree().get_network_unique_id()
	rpc(\"add_player\", Global.id, Global.player)

sync func add_player(id, data):
	# If I'm the server, send the info of existing players to new
	if get_tree().is_network_server():
		for peer_id in Global.players:
			rpc_id(id, \"add_player\", peer_id, Global.players[peer_id])
	
	# Load player
	Global.players[id] = data
	var player = load(\"res://Scenes/Core/Player.tscn\").instance()
	player.set_network_master(id)
	player.set_name(\"player\" + str(id))
	player.game_name = data[\"nickname\"]
	player.sex = data[\"sex\"]
	player.race = data[\"race\"]
	player.skintone = data[\"skintone\"]
	player.eyes = data[\"eyes\"]
	player.load_sprite()
	$World/Objetcs.add_child(player)

func _process(delta):
	pass"

[node name="World" type="Node"]

script = SubResource( 1 )

[node name="Chat" parent="." index="0" instance=ExtResource( 1 )]

[node name="TouchControls" parent="." index="1" instance=ExtResource( 2 )]

[node name="World" parent="." index="2" instance=ExtResource( 3 )]


